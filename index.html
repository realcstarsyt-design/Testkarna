<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Task / Verify Demo</title>
  <style>
    body { font-family: sans-serif; text-align:center; margin-top:50px; }
    button { font-size:18px; padding:10px 20px; margin:10px; }
    #verifyBtn { display:none; }
    #timer { font-size:20px; margin-top:20px; }
  </style>
</head>
<body>
  <h1>Task → Verify Demo</h1>

  <button id="taskBtn">Start Task</button>
  <button id="verifyBtn">Verify</button>

  <div id="timer">Timer: 0s</div>

<script>
let startTime = null;
let timerInterval = null;

// Open task.php
document.getElementById('taskBtn').addEventListener('click', () => {
  window.open("https://streamfiles.eu.org/task.php", "_blank");
  startTime = Date.now();
  document.getElementById('timer').textContent = "Timer started...";
  runFakeTimer();
});

// Fake timer: 100s compressed into 10s
function runFakeTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    let elapsed = (Date.now() - startTime)/1000; // real seconds
    let fakeElapsed = elapsed * 10; // speed ×10
    document.getElementById('timer').textContent = "Timer: " + fakeElapsed.toFixed(1) + "s (fake)";
    if(fakeElapsed >= 100){
      clearInterval(timerInterval);
      document.getElementById('verifyBtn').style.display = "inline-block";
    }
  }, 500);
}

// Verify button → open verify.php
document.getElementById('verifyBtn').addEventListener('click', () => {
  window.open("https://streamfiles.eu.org/verify.php", "_blank");
});
</script>
</body>
</html>  function appendLog(...parts){
    logEl.textContent = `${now()} — ${parts.join(' ')}\n` + logEl.textContent;
  }

  async function doGet(path){
    const url = baseEl.value.replace(/\/+$/,'') + '/' + path.replace(/^\/+/, '');
    appendLog('[fetch]', url);
    statusEl.textContent = `Fetching ${path} ...`;
    try{
      const res = await fetch(url, {method:'GET', credentials:'include'});
      const txt = await res.text();
      appendLog(`[resp ${res.status}] ${path} (len=${txt.length})`);
      statusEl.textContent = `Fetched ${path} — ${res.status}`;
      return {ok:res.ok, status:res.status, text: txt};
    }catch(err){
      appendLog('[error]', err.toString());
      statusEl.textContent = 'Fetch error';
      return {ok:false, status:0, text: String(err)};
    }
  }

  document.getElementById('openTask').addEventListener('click', async ()=>{
    appendLog('Opening task.php');
    const r = await doGet('task.php');
    if(r.text) appendLog('snippet:', r.text.slice(0,200).replace(/\n/g,' '));
  });

  document.getElementById('openVerify').addEventListener('click', async ()=>{
    appendLog('Opening verify.php');
    const r = await doGet('verify.php');
    if(r.text) appendLog('snippet:', r.text.slice(0,300).replace(/\n/g,' '));
  });

  document.getElementById('openBoth').addEventListener('click', async ()=>{
    appendLog('Open task → wait 5s → verify');
    await doGet('task.php');
    await new Promise(r=>setTimeout(r,5000));
    await doGet('verify.php');
  });

  document.getElementById('runWait').addEventListener('click', async ()=>{
    let s = parseFloat(document.getElementById('waitSec').value || '0');
    if(isNaN(s) || s < 0) { alert('Enter positive seconds'); return; }
    appendLog(`Open task → wait ${s}s → verify`);
    await doGet('task.php');
    appendLog(`Waiting ${s}s...`);
    await new Promise(r=>setTimeout(r, Math.round(s*1000)));
    await doGet('verify.php');
  });

})();
</script><p class="muted">Notes: If target site is cross-origin, the browser will only send cookies if the target sets CORS headers and allows credentials. Use local testing (same origin) to avoid CORS issues.</p>
</body>
</html>
